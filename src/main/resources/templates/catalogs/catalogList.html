<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link th:href="@{/css/style.css}" rel="stylesheet"/>
    <title>
        To Do List
    </title>
    <script src="/js/jquery-3.5.1.min.js"></script>
</head>

<body>
<div class="container">
    <h1><a href="/" style="text-decoration: none">To Do List</a></h1>

    <div id="totalelements">총 리스트 개수 : <span th:text="${catalogs.totalElements}"></span></div>
    <div class="text-right">
        <form name="form1" action="/" method="POST">
            <div id="Panel"></div>
            <div>
                <input id="inputBtn" class="btn btn-primary" value="등록" type="button" onclick="
            if(this.id === 'inputBtn'){
                showRegisterForm();
                this.id = 'registerBtn';
            }else{
                   insertContent();
                   this.id = 'inputBtn';
                   }
">
            </div>
        </form>
        <div>
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>제목</th>
                    <th>내용</th>
                    <th>날짜</th>
                    <th></th>
                    <th></th>
                </tr>
                </thead>
                <tbody id="tableBody">
                <tr th:each="catalog : ${catalogs}">
                    <td th:id="${catalog.id}+'title'" th:text="${catalog.title}"></td>
                    <td th:id="${catalog.id}+'content'" th:text="${catalog.content}"></td>
                    <td th:id="${catalog.id}+'this_date'" th:text="${catalog.this_date}"></td>
                    <td><a href="#" th:href="'javascript:deleteContent('+${catalog.id}+')'">삭제</a></td>
                    <td th:id="${catalog.id}+'update'"><a href="#"
                                                          th:href="'javascript:updateContent('+${catalog.id}+')'">수정</a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center">
<!--            <li class="page-item">-->
<!--                <a class="page-link" href="#" th:href="@{/(page=${catalogs.pageable.pageNumber - 1})}">이전</a>-->
<!--            </li>-->
            <li class="page-item" th:each="i: ${#numbers.sequence(startPage, endPage)}">
                <a class="page-link" href="#" th:href="'javascript:showPage('+${i - 1}+')'" th:text="${i}">1</a></li>

<!--            <li class="page-item">-->
<!--                <a class="page-link" href="#" th:href="@{/(page=${catalogs.pageable.pageNumber + 1})}">다음</a>-->
<!--            </li>-->
        </ul>
    </nav>
</div>
<script th:inline="javascript">

    var totalel = [[${catalogs.totalElements}]];//총 리스트 개수
    var page = 0;//페이지
    var size = 5;

    function showPage(localPage) {
        page = localPage;//페이지 다시 초기화 시켜줘야 연동됨
        $.ajax({
            url: "/list",
            type: "GET",
            data: {
                page: localPage,
                size: size
            },
            success: function (data) {
                console.log(data);
                showTable(data);
            }
        });
    }


    function deleteContent(id) {

        totalel = totalel - 1;
        $.ajax({
            url: id,
            type: "DELETE",
            success: function (data) {
                console.log(data);
                showPage(page);
            }
        });
        document.getElementById("Panel").innerHTML = "삭제되었습니다.";
    }

    function updateContent(id) {

        const title = document.getElementById(id + "title").textContent;
        const content = document.getElementById(id + "content").textContent;
        const this_date = document.getElementById(id + "this_date").textContent;


        document.getElementById(id + "title").innerHTML = "<input id = 'updateTitle' type = 'text' name = 'input_title' value = " + '"' + title + '"' + ">";
        document.getElementById(id + "content").innerHTML = "<input id = 'updateContent'type = 'text' name = 'input_content' value = " + '"' + content + '"' + ">";
        document.getElementById(id + "this_date").innerHTML = "<input id = 'updateThis_date'type = 'text' name = 'input_this_date' value = " + this_date + ">";
        document.getElementById(id + "update").innerHTML = "<a href=javascript:finishUpdateContent(" + id + ")>완료</a>"

    }

    function finishUpdateContent(id) {
        var temp1 = document.getElementById("updateTitle").value;
        var temp2 = document.getElementById("updateContent").value;

        $.ajax({
            url: id,
            type: "PUT",
            data: {
                title: temp1,
                content: temp2
            },
            success: function (data) {
                console.log(data);
                showPage(page);
            }
        });
        document.getElementById("Panel").innerHTML = "수정 되었습니다.";

    }

</script>
<script th:src="@{/js/fc.js}"></script>
</body>
</html>